# 用例 #401：AI 时间序列预测助手

**角色**：数据科学家 / 机器学习工程师 | **行业**：SaaS、科技、企业 | **任务**：分析、预测、预测性建模

---

## 详细介绍

**痛点：错过关键模式的朴素预测**

时间序列预测是应用数据科学中技术要求最高的领域之一，也是最常在缺乏充分专业知识的情况下尝试的领域之一。被首次分配构建收入预测任务的通才数据科学家通常会选择线性回归或简单移动平均——不是因为这些方法在原则上是错误的，而是因为判断它们何时适用、何时不适用需要理解平稳性、自相关结构、季节性分解，以及趋势外推与结构性预测之间的区别。"我可以对这些数据拟合一条线"和"我理解这个时间序列实际上在做什么"之间的差距是巨大的，而这种差距的后果随时间向前复合：一个忽略每周季节性模式的模型产生的误差不是随机的——它们是系统性的、可预测的，这意味着模型每周都在同一方向上自信地犯错。

仅诊断阶段就需要许多从业者缺乏的专业知识。在选择预测模型之前，数据科学家应该测试平稳性（ADF 检验、KPSS 检验）、检查自相关和偏自相关函数（ACF/PACF 图）、将序列分解为趋势、季节性和残差分量（经典分解或 STL）、检查结构性断裂，并评估序列是否在所需频率下具有足够的历史记录。在实践中，大多数团队跳过部分或全部这些步骤，直接进行模型拟合——在没有验证模型假设的情况下得出 ARIMA 模型，或在不了解 Prophet 的默认季节性设置假设了可能不成立的某些数据特征的情况下使用 Prophet。

模型选择是另一个独立的挑战。时间序列模型的格局涵盖经典方法（ARIMA、SARIMA、Holt-Winters 指数平滑）、现代概率框架（Prophet、NeuralProphet）、带滞后特征的梯度提升回归器（LightGBM、带时间特征的 XGBoost）和深度学习方法（LSTM、时间融合变换器）。每种方法都有由数据特征定义的适当使用场景：序列长度、季节性强度、是否有外部回归变量、预测范围是短期还是长期，以及可解释性还是准确性是主要目标。对于一种配置处于最先进水平的模型，对于另一种配置可能比简单的指数平滑模型显著更差。如果没有将数据特征与模型族匹配的系统框架，模型选择就会变成反复试验。

预测评估和沟通呈现出最后一层困难。平均绝对百分比误差（MAPE）是报告最广泛的预测指标，也是最具误导性的指标之一——当实际值为零时未定义，对较大的实际值惩罚过重，且无法跨不同规模的序列进行比较。置信区间通常被省略在业务预测中，因为数据科学家不确定如何正确生成它们（尤其是对于 ARIMA 等模型，区间计算假设经常失效），或者因为利益相关方不知道如何使用它们。结果是业务用户收到以虚假精度呈现的点预测，将其视为确定性，然后将预测失败归因于"数据质量差"，而不是他们从未被告知的固有不确定性。

**COCO 如何解决这一问题**

COCO 作为时间序列预测顾问——引导数据科学家完成从探索性诊断到模型选择、评估设计，再到向利益相关方沟通预测不确定性的完整预测工作流。

1. **时间序列诊断指导**：COCO 系统地走过预建模诊断清单——确定要运行哪些检验以及如何解释其输出，以便在模型选择开始之前表征序列。
   - 解释 ACF/PACF 图和平稳性检验结果，以识别 AR、MA 和差分阶数
   - 识别季节性周期、多个季节性层（例如每周 + 每年）和需要特殊处理的结构性断裂

2. **基于数据属性的模型选择**：COCO 使用结构化决策框架而非惯例，将特定时间序列的特征映射到适当的模型族。
   - 涵盖 ARIMA/SARIMA、Holt-Winters、Prophet、带滞后特征的 LightGBM、LSTM 和时间融合变换器，每种都有选择标准
   - 推荐基线模型（朴素季节性、季节平均），在得出复杂模型增加价值的结论之前必须超越这些基线

3. **预测输出解释**：COCO 解释预测输出的含义——包括趋势分量、季节分量、残差和不确定性来源——以支持模型调试和业务沟通的术语表达。
   - 将模型系数和分量估计转化为模型认为序列在做什么的自然语言描述
   - 识别残差模式何时表明模型错误规格（残差中保留的系统性模式）

4. **置信区间和不确定性范围设计**：COCO 指导正确的不确定性量化——包括何时以及如何生成预测区间、如何向非技术受众传达它们，以及哪些方法适合哪种模型类型。
   - 区分预测区间（用于单个未来观测值）和置信区间（用于均值预测）
   - 当正式区间对受众来说过于技术性时，推荐基于情景的不确定性框架（乐观/基础/悲观）

5. **预测评估协议设计**：COCO 设计在预测失败传播到业务决策之前捕获它的评估框架——涵盖指标选择、时间序列的交叉验证设计和回测方法。
   - 推荐时间序列适当的交叉验证（前向验证/扩展窗口），而非破坏时间顺序的朴素 k 折
   - 选择适合序列分布和规模的评估指标（MAE、RMSE、MASE、sMAPE、分位数预测的 Pinball 损失）

6. **向利益相关方沟通预测不确定性**：COCO 将技术性预测输出转化为利益相关方就绪的语言，传达适当的信心，既不产生虚假精度也不触发决策瘫痪。
   - 以商业术语（收入范围、单位范围）而非统计术语起草量化不确定性的预测叙事
   - 根据序列行为变化的速度设计预测更新节奏建议

**可量化的成果**

- **预测准确性**：通才数据科学家首次尝试预测的中位 MAPE → 28% → 应用结构化诊断和模型选择协议后 14%（精度提升 50%）
- **模型选择时间**：没有系统框架评估模型选项的小时数 → 平均 12 小时 → 结构化选择协议后 3 小时
- **残差自相关**：已发布模型中残差中仍存在统计显著自相关（表明模型错误规格）的比例 → 61% → 诊断优先方法后 18%
- **预测置信区间覆盖率**：包含经验证不确定性范围的业务预测比例 → 基线 12% → COCO 指导评估协议采用后 67%
- **利益相关方预测采用率**：财务/运营团队将提交的预测纳入规划模型的百分比 → 44% → 改进不确定性沟通后 78%

**受益角色**

- **通才数据科学家**：获得时间序列问题的结构化方法论，无需深度专业化即可防止最常见的诊断和模型选择错误
- **应用 ML 工程师**：利用评估协议设计指导构建更稳健的回测框架，在预发布而非生产中捕获模型失败
- **商业智能分析师**：利用 COCO 的不确定性沟通框架，以推动更好规划决策的格式向业务利益相关方呈现预测范围
- **数据科学管理者**：使用模型选择框架作为团队成员提交的时间序列项目的代码审查和设计审查清单

---

## 实用提示词

**提示词 1：时间序列诊断评估**
```
我有一个需要预测的时间序列数据集。在选择模型之前，请帮我进行完整的诊断评估。

序列描述：[正在测量的内容——例如"SaaS 产品的日活跃用户"]
频率：[小时 / 日 / 周 / 月]
历史长度：[N 个观测值，日期范围]
预测范围：[需要预测多远]
主要用途：[此预测驱动的决策]

我目前的诊断结果（粘贴您拥有的——跳过尚未运行的）：
- ADF 平稳性检验：[检验统计量，P 值，结论]
- KPSS 检验：[结果]
- ACF/PACF：[描述您看到的——例如"ACF 缓慢衰减，PACF 在滞后 2 截断"]
- 季节性分解：[描述趋势、季节性、残差特征]
- 已知结构性断裂：[日期和原因（如已知）]

基于此，请帮我：
1. 识别序列是否平稳以及需要什么变换（差分、对数）
2. 表征自相关结构（AR、MA 或混合；季节性与非季节性）
3. 识别存在的季节性周期（每周、每月、每年或多个）
4. 标记需要特殊处理的任何结构性断裂
5. 推荐我尚未完成的下一个诊断步骤
6. 生成此序列的摘要表征，以指导模型选择
```

**提示词 2：为我的时间序列选择模型**
```
根据我的时间序列特征，帮我选择正确的预测模型。

序列特征：
- 类型：[测量内容]
- 频率：[日 / 周 / 月]
- 长度：[N 个观测值]
- 预测范围：[短期：1-7 个周期 / 中期：8-30 / 长期：30+]
- 季节性：[无 / 单一 / 多个——描述周期]
- 趋势：[无 / 线性 / 非线性 / 结构性变化]
- 可用外部回归变量：[是/否——如是请列出]
- 可解释性要求：[高：必须向业务解释 / 低：黑盒可接受]
- 计算限制：[需要实时推理？重训练频率？]
- 历史预测准确性要求：[目标 MAPE / MASE / 其他]

对以下每个模型族，评估对我序列的适合度：
1. ARIMA/SARIMA——优缺点，基于我 ACF/PACF 的推荐 ARIMA 阶数
2. Holt-Winters 指数平滑——优缺点，哪种变体（加法/乘法）
3. Facebook Prophet——优缺点，配置注意事项
4. 带滞后特征的 LightGBM/XGBoost——优缺点，特征工程方法
5. LSTM 或时间融合变换器——优缺点，数据量要求

推荐我的主要模型、更简单的备用模型和我必须超越才能证明复杂性合理的基线模型。
```

**提示词 3：时间序列评估协议设计**
```
在声明模型可投入生产之前，我需要为时间序列预测模型设计严格的回测和评估框架。

序列：[描述]
我正在评估的模型：[模型名称和配置]
预测范围：[N 个周期]
计划的重训练节奏：[模型将多久重训练一次]
可用最小历史记录：[N 个观测值]

设计我的评估协议，涵盖：
1. 交叉验证方法：前向验证设计（折数、最小训练窗口大小、训练和测试之间的间隔（如果需要防止泄漏））
2. 指标选择：推荐适合我序列类型的准确性指标及原因（解释 MAPE 在这里是否适用）
3. 我必须超越的基线模型：定义适合我序列的具体朴素基线
4. 模型拟合后检查的残差诊断：列出带通过/失败标准的检验
5. 置信区间覆盖率测试：如何验证我的 80% 预测区间实际上包含 80% 的实际值
6. 失败模式检测：我评估结果中的什么模式表明模型不适合生产
7. 决策标准：什么评估阈值会让我有信心部署此模型？
```

**提示词 4：向利益相关方传达预测不确定性**
```
我有一个已完成的时间序列预测需要向非技术业务受众呈现。请帮我以允许自信规划而不产生虚假精度的方式传达预测及其不确定性。

预测背景：[预测内容和原因]
受众：[角色——例如"构建年度计划的财务团队"]
点预测：[值或范围]
预测区间（80% 或 95%）：[下限，上限]
可能使预测失效的已知风险：[列表]
历史回测中的模型准确性：[MAPE 或其他指标]

请帮我：
1. 将统计预测区间转换为基于情景的范围（乐观/基础/悲观），并用商业语言描述驱动每个情景的因素
2. 为业务受众起草一段预测摘要，说明点预测、现实范围和主要不确定性驱动因素
3. 以实际术语传达历史准确性的含义（例如"在回测中，该模型的 12 个月预测在 10 次中有 8 次在实际值的 X% 以内"）
4. 识别此预测中嵌入的业务团队应验证的前 3 个假设
5. 推荐预测更新节奏和触发条件（例如"每月刷新，或当[领先指标]移动超过 X% 时立即刷新"）
```

**提示词 5：预测失败诊断**
```
我的时间序列模型产生了明显错误的预测，我需要诊断根本原因。

序列：[描述]
模型：[模型名称和配置]
观察到的失败：[描述失败——例如"过去 3 个月持续低估实际值 15-20%"或"正确预测方向但量级差异很大"]
序列或业务背景的近期变化：[任何已知变化——新营销活动、产品变更、宏观事件]

帮我回答的诊断问题：
1. 残差模式分析：什么残差模式（系统性高估/低估、残差中的季节性、异方差性）对应什么模型失败模式？
2. 数据分布偏移：如何测试序列的统计属性自训练以来是否发生变化（概念漂移检测）？
3. 季节性失败模式：是什么导致之前正确处理季节性的模型开始错过季节性？
4. 外部回归变量失败：如果我使用外部特征，如何诊断特征是否变得陈旧、滞后不正确或失去预测能力？
5. 模型重训练诊断：我是否应该仅在近期数据上重训练、在所有数据上重训练或完全更换模型——什么证据能区分这些选择？

生成我可以系统性地排查以识别根本原因的诊断清单。
```

---
