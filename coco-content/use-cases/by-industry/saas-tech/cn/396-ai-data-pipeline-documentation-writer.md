# #396 — AI 数据流水线文档撰写器

**角色**：数据科学家
**行业**：SaaS / 科技
**任务**：文档
**标识**：`ai-data-pipeline-documentation-writer`

---

## 简介

数据流水线是每个机器学习系统的动脉，而其文档在 ML 开发生命周期中始终是最被忽视的制品。在一项对 300 个数据工程和数据科学团队的调查中，84% 的团队表示其数据流水线文档要么不完整、要么已过时、要么根本不存在。这些后果是严重的，且随时间不断累积：当文档缺失时，每个需要了解流水线的新团队成员都必须从代码中逆向工程——这个过程平均每条流水线需要 3-5 天，而且容易出错，因为逆向工程得出的理解往往会遗漏嵌入在转换逻辑中的细微业务规则。

"文档债务"现象在 ML 数据流水线中尤为严重，因为它们比标准 ETL 流水线在多个维度上都更为复杂。典型的 ML 特征工程流水线涉及：具有特定时间截止点的原始数据提取、带有时点正确性要求的多步骤连接逻辑、每一步都有领域特定业务规则的转换链、具有特定聚合窗口的特征计算、实体解析和去重逻辑、必须记录以确保可重现性的训练/验证/测试集划分逻辑，以及必须与训练时计算完全匹配的特征服务基础设施。如果文档缺失或错误，这些步骤中的每一步都是潜在的静默失败来源。

这个问题还因数据流水线是协作制品而进一步加剧：通常由数据工程、分析工程（dbt）和数据科学等不同角色的 3-6 人共同构建。每个贡献者对自己的部分了如指掌，但系统级文档——数据流向哪里、每个转换为何存在、隐式假设是什么——从未被写下来，因为每个人都以为其他人已经写了。

COCO 充当流水线文档协作撰写者，从代码、模式描述和业务逻辑的口头解释中生成完整的技术文档。工作流程如下：

1. **提供流水线代码或配置。** 粘贴你的 Airflow DAG、dbt 模型 SQL、Python 预处理脚本或 Spark 作业代码。
2. **补充业务背景。** 解释流水线产出什么、谁消费它，以及代码中不明显的任何业务规则。
3. **COCO 生成结构化文档。** 包括：流水线概述、数据流图（文本/Mermaid 格式）、分步技术描述、业务逻辑解释、依赖关系和数据来源、已知假设、故障模式，以及常见问题的运行手册。
4. **审查和纠正。** COCO 有时会误解代码中不清晰的业务逻辑——纠正后 COCO 将修订受影响的章节。
5. **随变更维护文档。** 当流水线发生变化时，粘贴差异，COCO 生成更新后的文档章节，使文档维护从一天的工作量变成 10 分钟的任务。

使用 COCO 进行流水线文档撰写的团队报告，新团队成员理解流水线所需的入职时间从平均 4.2 天降至 1.5 天。此外，由于此前不存在的运行手册现在得以建立，流水线故障的响应时间减少 40%。

**受益角色：**

- **数据科学家**：数月前构建的流水线需要在团队交接或合规审计前完成文档化
- **分析工程师**：编写包含复杂业务逻辑的 dbt 模型，这些逻辑并不自文档化
- **ML 工程师**：维护生产训练流水线，需要使其他团队成员能够处理事故的文档
- **数据工程负责人**：负责维护流水线组合中的文档标准

---

## 实用提示词

**提示词 1 — 从代码生成完整流水线文档**
```
我需要为数据流水线生成完整文档。相关代码如下：

流水线用途：[产出什么——如"为所有活跃客户计算每周流失预测特征"]
下游消费者：[谁使用它——如"ML 训练作业、实时评分特征存储"]

流水线代码：
```python
[粘贴您的 Airflow DAG / Python 流水线代码]
```

输入表模式：
[粘贴或描述输入表]

输出表模式：
[粘贴或描述输出]

代码中不明显的业务背景：
[如"90 天回溯窗口是因为我们的数据团队确定 90 天前的事件对流失预测没有价值"]

请生成完整的流水线文档，包括：概述、数据血缘、带业务逻辑解释的分步描述、假设条件、已知边缘情况，以及操作运行手册。
```

**提示词 2 — dbt 模型文档**
```
我需要为实现复杂业务逻辑的 dbt 模型（或模型链）编写文档。

模型名称：[模型名称]
模型用途：[计算什么]
上游模型/源表：[列表]
下游模型/消费者：[列表]

SQL 代码：
```sql
[粘贴您的 dbt 模型 SQL]
```

SQL 中不明显的业务规则：
[如"CASE WHEN revenue > 0 过滤是必要的，因为我们的计费系统有时在付款重试失败时记录 $0 交易"]
[如"我们用 customer_id 而非 user_id 连接，因为部分客户有多个用户账户"]

请生成：(1) 模型概述（schema.yml 描述块），(2) 所有输出列的列级文档，(3) 用浅显语言解释关键业务逻辑，(4) 应应用的数据质量测试，(5) 已知局限性或边缘情况。
```

**提示词 3 — ML 特征存储文档**
```
我需要为我们 ML 特征存储中的特征编写文档。背景如下：

特征组：[特征组名称]
实体：[如"customer_id"]
更新频率：[如"每日批次，UTC 时间凌晨 2 点"]
源表：[列表]

特征：
| 特征名称 | 数据类型 | 描述 | 源列 | 转换 |
|---------|---------|------|------|------|
| [F1]    | [类型]  | [描述] | [来源] | [转换] |
| [F2]    | [类型]  | [描述] | [来源] | [转换] |
[继续列出所有特征]

已知问题或注意事项：[列表]
当前使用此特征组的模型：[列表]

请生成完整的特征存储文档，包括：特征组概述、每个特征的技术文档、数据血缘、时点正确性说明、推荐使用指南，以及变更日志模板。
```

**提示词 4 — 流水线事故运行手册**
```
我需要为 [流水线名称] 数据流水线创建操作运行手册，使团队中任何人都能在不深入了解系统的情况下处理事故。

流水线概述：[简要描述]
技术栈：[Airflow/Prefect/dbt，数据仓库等]
调度：[运行时间]
SLA：[预期完成时间]

最常见的故障模式（根据经验）：
1. [故障类型1]：[表现形式，原因]
2. [故障类型2]：[表现形式，原因]
3. [故障类型3]：[表现形式，原因]

相关仪表板/监控链接：[列表]
应验证的数据质量检查：[列表]
升级路径：[描述何时联系谁]

请编写完整的事故运行手册，包含：故障检测程序、诊断决策树、每种故障模式的分步修复方案、数据质量验证步骤，以及流水线产出错误数据时的回滚程序。
```

**提示词 5 — 流水线变更后的文档更新**
```
我们的 [流水线名称] 流水线已更新，现有文档需要修订。变更内容如下：

旧行为：[描述]
新行为：[描述]

代码变更（差异或描述）：
[粘贴 diff 或描述变更]

现有文档：
[粘贴现有文档的相关章节]

请更新文档以反映变更：(1) 识别哪些章节现在不准确，(2) 用新行为重写这些章节，(3) 添加说明变更内容和原因的变更日志条目，(4) 标记可能受此变更影响且需要通知的下游消费者或依赖系统。
```
