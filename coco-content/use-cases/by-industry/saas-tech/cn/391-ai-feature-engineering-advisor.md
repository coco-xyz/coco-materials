# #391 — AI 特征工程顾问

**角色**：数据科学家
**行业**：SaaS / 科技
**任务**：分析
**标识**：`ai-feature-engineering-advisor`

---

## 简介

特征工程至今仍是应用机器学习中杠杆效应最高的环节，却也是系统化程度最低的环节。一项针对 Kaggle 大师和行业 ML 从业者的调查显示，82% 的受访者表示特征工程阶段最依赖直觉和领域专业知识，而非系统化方法论。一位构建客户生命周期价值模型的数据科学家，可能花费三周时间在原始特征上反复迭代，才发现一个简单的比率——过去 30 天收入除以过去 90 天收入——比任何单一原始变量都能更好地捕捉近期衰减效应。这个发现来自经验，而非流程。

糟糕的特征工程带来的损失是隐性的，但数额巨大。一家 B2B SaaS 公司的团队在构建线索评分模型时，花费六周时间尝试不同的模型架构（LightGBM、XGBoost、神经网络），直到一次咨询才发现核心问题在于特征表示：他们使用了没有任何时间窗口处理的原始 CRM 事件计数，导致来自未来事件的严重数据泄漏。该模型交叉验证 AUC 为 0.91，生产环境 AUC 只有 0.61——下跌 30 个点，本可在特征工程阶段被发现和避免。团队经常发布表现不佳的模型，不是因为算法选错了，而是信号本身就很弱或存在泄漏。

特征工程建议还极其依赖具体背景。适用于电商点击流数据的方法，对医疗时间序列或金融交易欺诈场景完全无效。书籍和课程教授通用技术（多项式特征、交互项、目标编码），但无法针对从业者手头的实际数据集和预测目标给出实时、具体的指导。高级工程师将这些知识存于脑中；团队中的初级工程师则只能通过反复试错重新发现，往往耗费数月的实验周期。

COCO 充当高级特征工程顾问，为每个数据集和任务随时提供咨询。工作流程如下：

1. **描述数据集和预测任务。** 提供数据模式、特征类型（类别型、连续型、时序型、文本型）、目标变量和训练时间范围。提供的上下文越多，建议越有针对性。
2. **分享当前特征集和基线。** 粘贴现有特征列表、当前模型性能，以及初次运行的特征重要性评分。COCO 以此为基础识别差距，而非从零开始重建。
3. **COCO 生成有针对性的特征建议。** 提出具体的新特征并附带实现指导——具体的 pandas 或 SQL 转换——按预期影响类别分组（近期性/频率/货币价值模式、交互特征、领域特定聚合、需要移除的泄漏风险项）。
4. **接受泄漏审计。** COCO 主动识别当前特征集中，在给定预测时间范围下存在时间泄漏风险的特征。
5. **针对特定特征族深入迭代。** 针对高基数类别变量的嵌入方法、时间序列的滞后特征创建，或基于用户-用户交互数据构建图特征等问题，进一步寻求深度建议。

使用 COCO 进行特征工程咨询的数据科学团队报告，达到目标模型性能所需的实验迭代次数减少了 40%。仅泄漏审计一项就帮助多个团队避免了原本只能在部署后才能发现的生产事故。初级数据科学家反馈，从"不知道还能尝试什么"到开展有效实验，只需一次对话。

**受益角色：**

- **数据科学家**：模型性能陷入平台期，需要超越现有领域知识的系统化特征构想
- **初级 ML 工程师**：缺乏高级导师指导，需要实时获得特征工程最佳实践建议
- **ML 团队负责人**：希望在模型推进到部署前标准化特征工程评审流程
- **分析工程师**：构建特征存储时需要推断哪些特征值得大规模物化

---

## 实用提示词

**提示词 1 — 分类任务的特征工程**
```
我正在构建 [分类任务，如"流失预测"] 模型。数据集结构如下：

表名：[表名]
- [字段1]：[类型，描述]
- [字段2]：[类型，描述]
- [字段3]：[类型，描述]
[继续列出所有相关字段]

预测目标：[目标变量]（二分类：[类别0] vs [类别1]）
观测粒度：每 [实体] 每 [时间周期] 一行
预测时间范围：提前 [X] 天预测 [目标]
训练数据时间跨度：[日期范围]

当前基线特征：[列出当前特征]
当前模型 AUC：[数值]

请建议 15-20 个新特征，每个特征包含：(1) 特征名称，(2) 背后的业务直觉，(3) 具体的 pandas/SQL 实现，(4) 预期信号方向，(5) 需注意的泄漏风险。
```

**提示词 2 — 时间序列的时序特征工程**
```
我正在使用 [框架，如"带滞后特征的 LightGBM"/"Prophet"/"N-BEATS"] 构建 [预测任务] 模型。时间序列数据信息：

实体：[预测对象，如"SKU 级别日销售额"]
粒度：[日/周/小时]
可用历史数据：[N 个月/年]
已知未来特征（外生变量）：[列出]
预测时间范围：[N 个周期]

当前滞后特征：[列出当前滞后项]
当前滚动统计特征：[列出当前滚动特征]

请就以下方面提供建议：(1) 应额外添加哪些滞后阶数及原因，(2) 遗漏了哪些滚动窗口统计，(3) 适用于该领域的日历/季节性特征，(4) 如何处理历史数据较短的实体的特征工程，(5) 如何通过扩展窗口交叉验证设置防止泄漏。
```

**提示词 3 — 高基数类别特征编码**
```
我的 [预测任务] 数据集中有以下高基数类别特征：

特征：[特征名1]
- 基数：[N 个唯一值]
- 分布：[均匀/长尾/其他]
- 与目标的关系：[已知或推测的关系]

特征：[特征名2]
- 基数：[N 个唯一值]
- 分布：[均匀/长尾/其他]

我的模型是 [模型类型，如"XGBoost"/"逻辑回归"/"神经网络"]。
训练集大小：[N 行]

对每个特征，请建议：(1) 最佳编码策略（目标编码、频率编码、实体嵌入、哈希等），(2) pandas/scikit-learn/category_encoders 的实现方式，(3) 防止目标编码泄漏的交叉验证注意事项，(4) 是否保留原特征或衍生更简单的代理特征。
```

**提示词 4 — 特征泄漏审计**
```
请对以下特征列表进行时间泄漏风险审计。模型设置如下：

预测任务：[任务]
预测时间点：特征以日期 T 为基准计算，预测 T+[预测期] 时的 [目标]
训练截止逻辑：[描述训练/测试集划分方式]

特征列表：
[粘贴完整特征列表及描述]

对每个特征，请分类：(1) 安全——预测时可用，无泄漏，(2) 存在风险——根据具体实现可能存在泄漏，(3) 存在泄漏——从定义上就包含未来信息。对存在风险和存在泄漏的特征，请说明泄漏机制并提出修正版本。
```

**提示词 5 — 特征选择与降维**
```
我的 [任务] 模型有 [N] 个特征，希望在最终训练前进行降维。当前情况：

模型类型：[模型类型]
特征数量：[N]
训练行数：[N 行]
当前性能：[指标]

初次运行的特征重要性：
[粘贴特征重要性输出——可来自 scikit-learn、SHAP 或 LightGBM]

已知共线性特征组：
[列出任何疑似的共线性组]

请推荐特征选择策略：(1) 根据重要性和冗余度应删除哪些特征，(2) 使用 SHAP、置换重要性还是互信息进行选择，(3) 如何处理相关特征组而不是随意删除其中一个，(4) PCA 或其他降维方法是否适用于本场景，(5) 如何验证删除特征不会损害样本外性能。
```
