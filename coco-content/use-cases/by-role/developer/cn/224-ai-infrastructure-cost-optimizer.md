# 用例 #224：AI 基础设施成本优化器

**角色**：开发工程师 / DevOps 工程师 / SRE / 工程经理 | **行业**：科技、SaaS、金融科技、电商 | **任务**：云成本优化、FinOps、基础设施规模校准

---
## 详细介绍

**痛点：云账单增速超过营收增速**

云基础设施成本已成为科技公司预算中最重要、增长最快的支出之一。普通工程团队在云资源上的超额支出达 30–40%——不是因为粗心，而是时间压力下一个个决策自然积累的结果：为安全起见选择的超配实例、24/7 运行的开发/预发布环境、不再匹配工作负载模式的预留实例，以及两年前已下线功能留下的孤立资源。一家年 AWS 支出 200 万美元的典型 B 轮 SaaS 公司，往往有 60–80 万美元的可优化浪费——且通常毫无察觉。

挑战在于架构的不透明性。云成本分散在数百种资源类型、数十个 Region 和多个账号或项目中。以 `db.r5.2xlarge` 规格配置一台 RDS 实例的后端工程师，可能不知道它 90% 的时间运行在 8% CPU 利用率上。对夜间批处理任务运行 EMR 集群的数据团队，可能没意识到迁移到 Spot 实例可以降低 70% 的成本。没人有时间审计每一个资源——而没有将成本清晰归因到功能、团队或工作负载，就没有效率激励的土壤。

后果不止是钱的浪费。超配的基础设施会制造虚假的性能余量安全感，掩盖真实的资源利用模式（这些模式本可揭示扩缩容机会），并虚高投资人和财务团队用来评估业务的单位经济指标。对于逼近盈利的公司，云优化往往是不牺牲研发效率就能改善利润率最快的路径。

**COCO 如何解决**

COCO 的 AI 基础设施成本优化器分析 AWS、GCP 和 Azure 的云支出模式，识别规模校准机会、预留实例建议、架构层面的节约点和资源浪费——生成优先级排序、可执行的成本削减路线图。

1. **跨云支出分析与归因**：COCO 构建关于资金流向和原因的全面图景。
   - 从 AWS Cost Explorer、GCP Billing 和 Azure Cost Management API 摄取账单数据
   - 使用标签、Label 和资源命名模式，将成本归因到服务、团队、环境（生产/预发布/开发）和功能
   - 识别未打标签或归因不明的资源（通常代表大量无主支出）
   - 逐月比较支出趋势，识别与部署或使用事件相关联的异常成本增长
   - 构建单位成本指标：每活跃用户成本、每笔交易成本、每次 API 调用成本——使成本对产品决策有意义

2. **规模校准分析**：最常见、价值最高的优化就是使用合适规格的资源。
   - 分析来自 CloudWatch、Cloud Monitoring 或 Azure Monitor 的 CPU、内存、网络和磁盘利用率指标
   - 识别持续运行在 30% CPU/内存利用率以下的实例——首要规模校准候选
   - 推荐具体的降配方案：实例系列、类型和规格，附预期节约额和风险评估
   - 考虑突发模式：区分需要为流量尖峰保留余量的实例与单纯超配的实例
   - 应用数据库专项分析：RDS/CloudSQL 规模校准、连接数分析、IOPS vs. 预配置 IOPS 对比

3. **预留实例与 Savings Plan 优化**：基于承诺的折扣可提供比按需定价 30–72% 的节约。
   - 分析工作负载稳定性，识别哪些资源适合 1 年或 3 年预留实例，哪些适合 Spot/抢占式
   - 识别即将到期的预留实例，根据当前使用模式推荐续期或替换
   - 检测不再匹配运行工作负载的预留实例（为已下线或已调整大小的工作负载购买的）
   - 跨实例系列、Region 和服务计算最优承诺组合
   - 建模 Savings Plan 选项（Compute、EC2 Instance、SageMaker），推荐最优覆盖级别

4. **架构层面的成本机会**：有时最大的节约需要重新思考基础设施的构建方式。
   - 识别过度设计的解决方案：非关键开发/预发布工作负载的多 AZ 配置、本可使用 VPC Endpoint 的流量却走了 NAT Gateway、昂贵的托管服务有更简单的替代方案
   - 分析数据传输成本——往往不可见但相当可观：跨 AZ、跨 Region、互联网出口流量
   - 识别可降低计算和数据库成本的缓存机会
   - 发现 Serverless 迁移候选：突发性、低频工作负载使用 Lambda vs. 长期运行的 EC2
   - 分析存储分层：应进入 S3 Intelligent-Tiering、Glacier 或过期删除的 S3 Standard 数据

5. **闲置与孤立资源检测**：死亡资源是纯粹的浪费。
   - 识别仍在产生 EBS 成本的已停止 EC2 实例、未挂载的 EBS 卷、未使用的 Elastic IP
   - 检测没有活跃目标的空闲负载均衡器
   - 标记在非工作时间运行的开发和测试资源（可调度关停）
   - 识别未使用的 RDS 实例、超出保留策略的快照和过时的 AMI
   - 浮现"僵尸"资源：为实验或演示部署但从未清理的资源

6. **成本削减路线图与节约预测**：将分析转化为可操作计划。
   - 按工作量 vs. 节约额对建议排序：快速见效（终止闲置资源、明显超配的规模调整）vs. 较长期项目（架构变更）
   - 为每个建议估算每月节约额、实施复杂度和任何风险
   - 在建议实施后追踪已实现的节约
   - 生成适合工程和财务管理层的 FinOps 报告

**量化结果**

- **识别节约额**：首次分析通常识别 25–40% 的云支出可优化
- **快速见效节约**：闲置资源清理和规模校准在 2–4 周内产生 10–20% 的即时成本降低
- **预留实例优化**：承诺优化通常为符合条件的工作负载额外节约 15–25%
- **单位经济改善**：架构优化后每笔交易成本改善 30–50%
- **洞察效率**：云成本分析时间从 2 周的财务审计缩短至 2 小时的 COCO 会话
- **工程师意识**：有 COCO 成本归因的团队，新部署中不必要资源配置减少 40%

**谁会受益**

- **DevOps / 平台工程师**：获得具体、安全的规模校准建议，而非泛泛的"优化云成本"建议
- **工程经理**：能够用有数据支撑的理由为团队分配成本削减目标，并追踪进展
- **开发工程师**：了解基础设施决策的成本影响，实现成本意识工程
- **CFO / 财务**：获得工程验证的成本削减路线图，含实际时间线和预期节约额

---

## 实用提示词

**提示词 1：全面云成本审计**
```
我需要对我们的云基础设施成本进行全面审计。

云背景：
- 主要云平台：[AWS / GCP / Azure / 多云：请说明]
- 每月支出：约 $[X]
- 主要使用的服务：[EC2/GCE/VM、RDS/CloudSQL、S3/GCS、EKS/GKE、Lambda/Cloud Functions 等]
- 环境：[生产、预发布、开发——各有多少]
- 团队规模：[N] 名工程师
- 标签/Label：[完善 / 部分 / 极少——资源归因的质量]

我可以提供：
- AWS Cost Explorer 导出 / GCP 账单导出：[是/否]
- 关键实例的 CloudWatch 指标：[是/否]
- 运行中的 EC2/VM 实例及规格列表：[粘贴或描述]
- 当前预留实例清单：[是/否]

主要关注点：
- [如"上季度 AWS 账单增长 35%，但用户量没有对应增长"]
- [如"我们看不到是什么在驱动成本尖峰"]
- [如"管理层要求在不裁减工程师的情况下降低 20% 成本"]

请：
1. 识别前 5 大成本驱动因素，并判断是否合理
2. 发现最高价值的规模校准机会（利用率 < 30% 的实例）
3. 识别适合立即终止的闲置和孤立资源
4. 估算按类别分解的总可优化节约额
5. 生成优先级行动列表：快速见效（< 1 天工作量）vs. 中期项目
```

**提示词 2：预留实例与 Savings Plan 策略**
```
我们需要优化 AWS 预留实例和 Savings Plan 覆盖率。

当前状态：
- 每月按需支出：$[X]
- 当前 RI 覆盖率：[计算支出的 %，或"极少"]
- 未来 90 天内到期的 RI：[列表或数量]
- 工作负载稳定性：[描述哪些工作负载 24/7 运行 vs. 突发性 vs. 可变]

实例清单（粘贴或描述）：
- 生产环境：[列出实例类型和数量]
- 预发布环境：[列出]
- 批处理/分析：[列出]

约束条件：
- 预付承诺预算：[是否能一次性付款，还是倾向于月付]
- 偏好的最短承诺期：[1 年 / 3 年 / 无偏好]
- 实例系列灵活性：[如有需要，能否切换系列？]

请：
1. 分析哪些工作负载足够稳定，适合 1 年 vs. 3 年承诺
2. 推荐具体的 RI 购买或 Savings Plan 覆盖方案，附预期节约额
3. 识别不应续期的现有 RI（工作负载已变更）
4. 建模相对于当前按需支出的总节约额
5. 推荐分阶段购买策略，避免过度承诺
```

**提示词 3：非生产环境成本削减计划**
```
我们的非生产环境（预发布、开发、QA）成本过高。

当前情况：
- 预发布环境每月成本：$[X]
- 开发环境每月成本：$[X]
- 这些环境 24/7 运行，但工程师使用时间约为每天 8 小时
- 预发布环境 1:1 镜像生产环境实例规格（可能没必要）

环境详情：
- 预发布环境：[列出关键组件：应用服务器、数据库、缓存、队列]
- 开发环境：[数量，包含什么内容]
- 使用模式：[何时是活跃使用期]

请：
1. 识别哪些预发布/开发资源可以在非工作时间（夜间/周末）调度关停
2. 推荐合适的降配方案：预发布不需要生产级别的实例规格
3. 估算调度关停 + 非生产规模校准后的每月节约额
4. 建议自动化环境调度工具（AWS Instance Scheduler、Terraform 等）
5. 识别哪些组件必须 24/7 运行（CI/CD、监控）vs. 哪些可以关停
6. 估算每项优化的实施工作量
```
